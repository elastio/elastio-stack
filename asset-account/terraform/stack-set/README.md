# Elastio Asset Account CloudFormation StackSet

See [this README](../..) for more details on what this stack does.

This is a Terraform module, that is a thin wrapper on top of an [`aws_cloudformation_stack_set`](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set) and [`aws_cloudformation_stack_instances`](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_instances) resources used to deploy the Elastio Asset Account stack.

See the `examples` directory for some examples of how this module can be used:

- `self-managed` - deploy the stack set using the [self-managed permission model](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create-self-managed.html)
- `service-managed` - deploy the stack set using the [service-managed permission model](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-orgs-associate-stackset-with-org.html)

## Installation

[Configure](../../../README.md#configuring-the-terraform-modules-registry) the Elastio terraform module registry, and add this to your project:

```tf
module "elastio_asset_account" {
  source  = "terraform.cloudsmith.io/public/elastio-asset-account-stack-set/aws"
  version = "0.33.1"

  // Provide input parameters
}
```

<!-- BEGIN_TF_DOCS -->

## Requirements

| Name                                                                     | Version |
| ------------------------------------------------------------------------ | ------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | ~> 1.0  |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | ~> 5.0  |

## Providers

| Name                                             | Version |
| ------------------------------------------------ | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws) | ~> 5.0  |

## Modules

No modules.

## Resources

| Name                                                                                                                                                  | Type     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [aws_cloudformation_stack_instances.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_instances) | resource |
| [aws_cloudformation_stack_set.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set)             | resource |

## Inputs

| Name                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                  | Type                                                                                                                                                                                                                                                                                                                                                                                                          | Default                                                                                                                                                                                                                                                    | Required |
| ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_administration_role_arn"></a> [administration_role_arn](#input_administration_role_arn)       | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#administration_role_arn-1)                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_auto_deployment"></a> [auto_deployment](#input_auto_deployment)                               | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#auto_deployment-1)                                                                                                                                                                                                                                                                      | <pre>object({<br/> enabled = optional(bool)<br/> retain_stacks_on_account_removal = optional(bool)<br/> })</pre>                                                                                                                                                                                                                                                                                              | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_call_as"></a> [call_as](#input_call_as)                                                       | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#call_as-1)                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_deployment_targets"></a> [deployment_targets](#input_deployment_targets)                      | The AWS Organizations accounts for which to create stack instances.<br/><br/>Specify `deployment_targets` only if you are using `SERVICE_MANAGED` permissions model.<br/>If you are using the `SELF_MANAGED` permissions model specify `accounts` instead.<br/><br/>[Details](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_instances#deployment_targets) | <pre>object({<br/> account_filter_type = optional(string)<br/> accounts = optional(list(string))<br/> accounts_url = optional(string)<br/> organizational_unit_ids = optional(list(string))<br/> })</pre>                                                                                                                                                                                                     | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_encrypt_with_cmk"></a> [encrypt_with_cmk](#input_encrypt_with_cmk)                            | Provision an additional customer-managed KMS key to encrypt Lambda environment variables.<br/>This increases the cost of the stack.                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                        | `false`                                                                                                                                                                                                                                                    |    no    |
| <a name="input_execution_role_name"></a> [execution_role_name](#input_execution_role_name)                   | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#execution_role_name-1)                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_iam_resource_names_prefix"></a> [iam_resource_names_prefix](#input_iam_resource_names_prefix) | Add a custom prefix to names of all IAM resources deployed by this stack.                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `""`                                                                                                                                                                                                                                                       |    no    |
| <a name="input_iam_resource_names_suffix"></a> [iam_resource_names_suffix](#input_iam_resource_names_suffix) | Add a custom prefix to names of all IAM resources deployed by this stack.                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `""`                                                                                                                                                                                                                                                       |    no    |
| <a name="input_lambda_tracing"></a> [lambda_tracing](#input_lambda_tracing)                                  | Enable AWS X-Ray tracing for Lambda functions.<br/>This increases the cost of the stack.                                                                                                                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                                                                                                                                                                                        | `false`                                                                                                                                                                                                                                                    |    no    |
| <a name="input_managed_execution"></a> [managed_execution](#input_managed_execution)                         | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#managed_execution-1)                                                                                                                                                                                                                                                                    | <pre>object({<br/> active = optional(bool)<br/> })</pre>                                                                                                                                                                                                                                                                                                                                                      | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_operation_preferences"></a> [operation_preferences](#input_operation_preferences)             | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_instances#operation_preferences)                                                                                                                                                                                                                                                            | <pre>object({<br/> concurrency_mode = optional(string)<br/> failure_tolerance_count = optional(number)<br/> failure_tolerance_percentage = optional(number)<br/> max_concurrent_count = optional(number)<br/> max_concurrent_percentage = optional(number)<br/><br/> # Region settings are not supported, because<br/> # there must be at most one stack per account<br/> # in a single region.<br/> })</pre> | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_permission_model"></a> [permission_model](#input_permission_model)                            | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_set#permission_model-1)                                                                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_retain_stacks"></a> [retain_stacks](#input_retain_stacks)                                     | [See docs here](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack_instances#retain_stacks-1)                                                                                                                                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                     |    no    |
| <a name="input_stack_instances_region"></a> [stack_instances_region](#input_stack_instances_region)          | The AWS region where the Elastio Asset Account stack instances will be deployed.<br/>It is just a single region because this stack is deployed only once per AWS account.                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `"us-east-1"`                                                                                                                                                                                                                                              |    no    |
| <a name="input_stack_set_description"></a> [stack_set_description](#input_stack_set_description)             | The description of the CloudFormation StackSet.                                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `"Elastio Asset Account StackSet creates IAM roles to link the AWS accounts with\nthe Elastio Connector. This allows the Elastio Connector to scan the assets\navailable in the account where the Elastio Asset Account stack instances are\ndeployed.\n"` |    no    |
| <a name="input_stack_set_name"></a> [stack_set_name](#input_stack_set_name)                                  | The name of the CloudFormation StackSet.                                                                                                                                                                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | `"ElastioAssetAccount"`                                                                                                                                                                                                                                    |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                | Additional tags to apply to all resources created by this stack.                                                                                                                                                                                                                                                                                                                                             | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                 | `{}`                                                                                                                                                                                                                                                       |    no    |
| <a name="input_template_url"></a> [template_url](#input_template_url)                                        | The URL of the Elastio Asset Account CloudFormation template obtained from<br/>the Elastio Portal.<br/><br/>This parameter is sensitive, because anyone who knows this URL can deploy<br/>Elastio Account stack and linking it to your Elastio tenant.                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                      | n/a                                                                                                                                                                                                                                                        |   yes    |

## Outputs

| Name                                                                             | Description                                                     |
| -------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| <a name="output_stack_instances"></a> [stack_instances](#output_stack_instances) | The outputs of the aws_cloudformation_stack_instances resource. |
| <a name="output_stack_set"></a> [stack_set](#output_stack_set)                   | The outputs of the aws_cloudformation_stack_set resource.       |

<!-- END_TF_DOCS -->
